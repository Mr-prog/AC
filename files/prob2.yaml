; fib_even_sum.asm
; Вычислить сумму чётных чисел Фибоначчи, не превышающих 4 млн

start:
    LOADI 1, R1                     ; Первое число Фибоначчи
    LOADI 2, R2                     ; Второе число Фибоначчи
    LOADI 0, R3                     ; Сумма чётных чисел
    LOADI 4000000, R4               ; Предел вычислений

fib_loop:
    ADD R1, R2, R5                  ; Вычислить следующее число Фибоначчи
    MOV R2, R1                      ; Обновить R1
    MOV R5, R2                      ; Обновить R2

    MOD R5, 2, R6                   ; Проверка чётности
    JZ R6, add_to_sum               ; Если число чётное, перейти к добавлению

check_limit:
    SUB R4, R5, R7                  ; Проверка, не превышает ли число лимит
    JZ R7, end                      ; Если превышает, завершить программу
    JUMP fib_loop                   ; Иначе продолжить цикл

add_to_sum:
    ADD R3, R5, R3                  ; Добавить чётное число к сумме
    JUMP check_limit                ; Вернуться к проверке предела

end:
    WRITE_PORT R3, POUT             ; Вывести сумму на экран
    NOP                             ; Завершение программы
